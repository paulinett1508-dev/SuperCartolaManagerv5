<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>API Football - Analytics | Super Cartola Manager</title>
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="css/_admin-tokens.css" />
        <link rel="stylesheet" href="style.css" />
        <link rel="stylesheet" href="css/modules/dashboard-redesign.css" />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Russo+One&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <style>
            .analytics-page {
                background: #121212;
                min-height: 100vh;
            }
            .analytics-content {
                padding: 20px 16px;
                max-width: 1200px;
                margin: 0 auto;
            }
            .analytics-header {
                background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
                border-radius: 12px;
                padding: 24px;
                margin-bottom: 24px;
                border: 1px solid #2d2d2d;
                display: flex;
                align-items: center;
                gap: 16px;
            }
            .analytics-header-icon {
                width: 56px;
                height: 56px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .analytics-header-icon .material-icons {
                font-size: 28px;
                color: white;
            }
            .analytics-header h1 {
                font-size: 1.5rem;
                font-weight: 700;
                color: #ffffff;
                margin: 0 0 4px 0;
            }
            .analytics-header p {
                font-size: 0.85rem;
                color: #9ca3af;
                margin: 0;
            }

            /* Stats Cards */
            .stats-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
                margin-bottom: 24px;
            }
            .stat-card {
                background: #1a1a1a;
                border-radius: 12px;
                padding: 20px;
                border: 1px solid #2d2d2d;
            }
            .stat-card-header {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 12px;
            }
            .stat-card-icon {
                width: 40px;
                height: 40px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .stat-card-icon.green { background: rgba(16, 185, 129, 0.15); }
            .stat-card-icon.green .material-icons { color: #10b981; }
            .stat-card-icon.orange { background: rgba(255, 85, 0, 0.15); }
            .stat-card-icon.orange .material-icons { color: #FF5500; }
            .stat-card-icon.blue { background: rgba(59, 130, 246, 0.15); }
            .stat-card-icon.blue .material-icons { color: #3b82f6; }
            .stat-card-icon.yellow { background: rgba(245, 158, 11, 0.15); }
            .stat-card-icon.yellow .material-icons { color: #f59e0b; }
            .stat-card-label {
                font-size: 0.75rem;
                font-weight: 600;
                color: #9ca3af;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            .stat-card-value {
                font-size: 2rem;
                font-weight: 700;
                color: #ffffff;
                margin-bottom: 4px;
            }
            .stat-card-sub {
                font-size: 0.75rem;
                color: #6b7280;
            }
            .stat-card-sub.success { color: #10b981; }
            .stat-card-sub.warning { color: #f59e0b; }
            .stat-card-sub.danger { color: #ef4444; }

            /* Progress Bar */
            .progress-container {
                margin-top: 12px;
            }
            .progress-bar {
                height: 8px;
                background: #2d2d2d;
                border-radius: 4px;
                overflow: hidden;
            }
            .progress-fill {
                height: 100%;
                border-radius: 4px;
                transition: width 0.5s ease;
            }
            .progress-fill.green { background: linear-gradient(90deg, #10b981, #059669); }
            .progress-fill.yellow { background: linear-gradient(90deg, #f59e0b, #d97706); }
            .progress-fill.red { background: linear-gradient(90deg, #ef4444, #dc2626); }

            /* Sections */
            .section {
                background: #1a1a1a;
                border-radius: 12px;
                border: 1px solid #2d2d2d;
                margin-bottom: 24px;
                overflow: hidden;
            }
            .section-header {
                padding: 16px 20px;
                border-bottom: 1px solid #2d2d2d;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .section-title {
                font-size: 1rem;
                font-weight: 600;
                color: #ffffff;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .section-title .material-icons {
                color: #FF5500;
                font-size: 20px;
            }
            .section-body {
                padding: 20px;
            }

            /* Leagues Table */
            .leagues-table {
                width: 100%;
                border-collapse: collapse;
            }
            .leagues-table th,
            .leagues-table td {
                padding: 12px 16px;
                text-align: left;
                border-bottom: 1px solid #2d2d2d;
            }
            .leagues-table th {
                font-size: 0.7rem;
                font-weight: 600;
                color: #9ca3af;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            .leagues-table td {
                font-size: 0.85rem;
                color: #ffffff;
            }
            .leagues-table tr:last-child td {
                border-bottom: none;
            }
            .league-id {
                font-family: monospace;
                background: #252525;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.75rem;
                color: #9ca3af;
            }

            /* Live Games */
            .live-games-list {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
            .live-game {
                background: #252525;
                border-radius: 10px;
                padding: 16px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .live-game-teams {
                display: flex;
                align-items: center;
                gap: 12px;
                flex: 1;
            }
            .live-game-team {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .live-game-team img {
                width: 28px;
                height: 28px;
                object-fit: contain;
            }
            .live-game-team span {
                font-size: 0.9rem;
                font-weight: 500;
                color: #ffffff;
            }
            .live-game-score {
                font-size: 1.25rem;
                font-weight: 700;
                color: #ffffff;
                padding: 0 16px;
            }
            .live-game-info {
                text-align: right;
            }
            .live-game-time {
                font-size: 0.85rem;
                font-weight: 600;
                color: #10b981;
            }
            .live-game-league {
                font-size: 0.7rem;
                color: #6b7280;
            }
            .no-games {
                text-align: center;
                padding: 40px;
                color: #6b7280;
            }
            .no-games .material-icons {
                font-size: 48px;
                margin-bottom: 12px;
                opacity: 0.5;
            }

            /* Status Badge */
            .status-badge {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            .status-badge.online {
                background: rgba(16, 185, 129, 0.15);
                color: #10b981;
            }
            .status-badge.offline {
                background: rgba(239, 68, 68, 0.15);
                color: #ef4444;
            }
            .status-badge .dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: currentColor;
            }
            .status-badge.online .dot {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }

            /* Refresh Button */
            .refresh-btn {
                background: #252525;
                border: 1px solid #3d3d3d;
                color: #ffffff;
                padding: 8px 16px;
                border-radius: 8px;
                font-size: 0.8rem;
                font-weight: 500;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 6px;
                transition: all 0.2s ease;
            }
            .refresh-btn:hover {
                background: #3d3d3d;
                border-color: #FF5500;
            }
            .refresh-btn .material-icons {
                font-size: 18px;
            }
            .refresh-btn.loading .material-icons {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }

            /* Back Link */
            .back-link {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                color: #9ca3af;
                text-decoration: none;
                font-size: 0.85rem;
                margin-bottom: 16px;
                transition: color 0.2s;
            }
            .back-link:hover {
                color: #FF5500;
            }
        </style>
    </head>

    <body>
        <div class="app-container">
            <div id="sidebar-placeholder"></div>

            <main class="app-main analytics-page">
                <div class="analytics-content">
                    <!-- Back Link -->
                    <a href="ferramentas.html" class="back-link">
                        <span class="material-icons">arrow_back</span>
                        Voltar para Ferramentas
                    </a>

                    <!-- Header -->
                    <header class="analytics-header">
                        <div class="analytics-header-icon">
                            <span class="material-icons">sports_soccer</span>
                        </div>
                        <div>
                            <h1>API Football - Analytics</h1>
                            <p>Monitoramento de uso e status da integracao com jogos ao vivo</p>
                        </div>
                    </header>

                    <!-- Stats Row -->
                    <div class="stats-row">
                        <!-- Status -->
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon green">
                                    <span class="material-icons">check_circle</span>
                                </div>
                                <span class="stat-card-label">Status</span>
                            </div>
                            <div id="api-status">
                                <span class="status-badge offline">
                                    <span class="dot"></span>
                                    Verificando...
                                </span>
                            </div>
                        </div>

                        <!-- Requests -->
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon orange">
                                    <span class="material-icons">speed</span>
                                </div>
                                <span class="stat-card-label">Requests Hoje</span>
                            </div>
                            <div class="stat-card-value" id="requests-atual">-</div>
                            <div class="stat-card-sub" id="requests-limite">de - disponiveis</div>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill green" id="requests-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Plano -->
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon blue">
                                    <span class="material-icons">card_membership</span>
                                </div>
                                <span class="stat-card-label">Plano</span>
                            </div>
                            <div class="stat-card-value" id="plano-nome">-</div>
                            <div class="stat-card-sub" id="plano-conta">Conta: -</div>
                        </div>

                        <!-- Jogos ao Vivo -->
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon yellow">
                                    <span class="material-icons">live_tv</span>
                                </div>
                                <span class="stat-card-label">Jogos ao Vivo (Brasil)</span>
                            </div>
                            <div class="stat-card-value" id="jogos-ao-vivo">-</div>
                            <div class="stat-card-sub" id="jogos-fonte">Fonte: -</div>
                        </div>
                    </div>

                    <!-- Jogos ao Vivo -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">
                                <span class="material-icons">sports_soccer</span>
                                Jogos ao Vivo no Brasil
                            </span>
                            <button class="refresh-btn" onclick="carregarJogos()">
                                <span class="material-icons">refresh</span>
                                Atualizar
                            </button>
                        </div>
                        <div class="section-body">
                            <div class="live-games-list" id="live-games">
                                <div class="no-games">
                                    <span class="material-icons">sports_soccer</span>
                                    <p>Carregando jogos...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ligas Monitoradas -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">
                                <span class="material-icons">flag</span>
                                Ligas Brasileiras Monitoradas
                            </span>
                        </div>
                        <div class="section-body" style="padding: 0;">
                            <table class="leagues-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Liga</th>
                                        <th>Temporada</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="league-id">71</span></td>
                                        <td>Brasileirao Serie A</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">72</span></td>
                                        <td>Brasileirao Serie B</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">73</span></td>
                                        <td>Copa do Brasil</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">475</span></td>
                                        <td>Campeonato Carioca</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">76</span></td>
                                        <td>Campeonato Paulista</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">629</span></td>
                                        <td>Copa Verde</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">630</span></td>
                                        <td>Copa do Nordeste</td>
                                        <td>2026</td>
                                    </tr>
                                    <tr>
                                        <td><span class="league-id">618</span></td>
                                        <td>Copinha (Sao Paulo Youth Cup)</td>
                                        <td>2026</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Informacoes Tecnicas -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">
                                <span class="material-icons">info</span>
                                Informacoes Tecnicas
                            </span>
                        </div>
                        <div class="section-body">
                            <table class="leagues-table">
                                <tbody>
                                    <tr>
                                        <td style="color: #9ca3af; width: 200px;">Endpoint Base</td>
                                        <td><code style="background:#252525;padding:4px 8px;border-radius:4px;font-size:0.8rem;">https://v3.football.api-sports.io</code></td>
                                    </tr>
                                    <tr>
                                        <td style="color: #9ca3af;">Rota Interna</td>
                                        <td><code style="background:#252525;padding:4px 8px;border-radius:4px;font-size:0.8rem;">/api/jogos-ao-vivo</code></td>
                                    </tr>
                                    <tr>
                                        <td style="color: #9ca3af;">Cache TTL</td>
                                        <td>10 minutos</td>
                                    </tr>
                                    <tr>
                                        <td style="color: #9ca3af;">Fallback</td>
                                        <td>Scraper Globo Esporte (agenda do dia)</td>
                                    </tr>
                                    <tr>
                                        <td style="color: #9ca3af;">Limite Diario</td>
                                        <td>100 requests/dia (plano Free)</td>
                                    </tr>
                                    <tr>
                                        <td style="color: #9ca3af;">Reset do Limite</td>
                                        <td>00:00 UTC</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </main>
        </div>

        <!-- Scripts -->
        <script type="module">
            // Carregar layout
            async function loadLayout() {
                try {
                    const response = await fetch("layout.html");
                    const layoutHtml = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(layoutHtml, "text/html");

                    const sidebar = doc.querySelector(".app-sidebar");
                    if (sidebar) {
                        document.getElementById("sidebar-placeholder")?.replaceWith(sidebar);
                    }

                    const scripts = doc.querySelectorAll("script");
                    scripts.forEach((script) => {
                        if (script.textContent.trim()) {
                            const newScript = document.createElement("script");
                            newScript.textContent = script.textContent;
                            document.head.appendChild(newScript);
                        }
                    });
                } catch (error) {
                    console.error("Erro ao carregar layout:", error);
                }
            }

            // Carregar status da API
            async function carregarStatus() {
                try {
                    const response = await fetch('/api/jogos-ao-vivo/status');
                    const data = await response.json();

                    // Status
                    const statusEl = document.getElementById('api-status');
                    if (data.configurado) {
                        statusEl.innerHTML = `
                            <span class="status-badge online">
                                <span class="dot"></span>
                                Online
                            </span>
                        `;
                    } else {
                        statusEl.innerHTML = `
                            <span class="status-badge offline">
                                <span class="dot"></span>
                                Offline
                            </span>
                        `;
                    }

                    // Requests
                    const atual = data.requisicoes?.atual || 0;
                    const limite = data.requisicoes?.limite || 100;
                    const percentual = (atual / limite) * 100;

                    document.getElementById('requests-atual').textContent = atual;
                    document.getElementById('requests-limite').textContent = `de ${limite} disponiveis`;

                    const progressEl = document.getElementById('requests-progress');
                    progressEl.style.width = `${percentual}%`;

                    // Cor do progresso baseado no uso
                    progressEl.classList.remove('green', 'yellow', 'red');
                    if (percentual < 50) {
                        progressEl.classList.add('green');
                        document.getElementById('requests-limite').className = 'stat-card-sub success';
                    } else if (percentual < 80) {
                        progressEl.classList.add('yellow');
                        document.getElementById('requests-limite').className = 'stat-card-sub warning';
                    } else {
                        progressEl.classList.add('red');
                        document.getElementById('requests-limite').className = 'stat-card-sub danger';
                    }

                    // Plano
                    document.getElementById('plano-nome').textContent = data.plano || 'Free';
                    document.getElementById('plano-conta').textContent = `Conta: ${data.conta || '-'}`;

                } catch (error) {
                    console.error('Erro ao carregar status:', error);
                    document.getElementById('api-status').innerHTML = `
                        <span class="status-badge offline">
                            <span class="dot"></span>
                            Erro
                        </span>
                    `;
                }
            }

            // Carregar jogos ao vivo
            window.carregarJogos = async function() {
                const btn = document.querySelector('.refresh-btn');
                btn.classList.add('loading');

                try {
                    const response = await fetch('/api/jogos-ao-vivo');
                    const data = await response.json();

                    // Contador
                    document.getElementById('jogos-ao-vivo').textContent = data.jogos?.length || 0;
                    document.getElementById('jogos-fonte').textContent = `Fonte: ${data.fonte || '-'}`;

                    // Lista de jogos
                    const container = document.getElementById('live-games');

                    if (!data.jogos || data.jogos.length === 0) {
                        container.innerHTML = `
                            <div class="no-games">
                                <span class="material-icons">sports_soccer</span>
                                <p>${data.mensagem || 'Nenhum jogo ao vivo no momento'}</p>
                                <p style="font-size: 0.75rem; margin-top: 8px;">Fonte: ${data.fonte || '-'}</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = data.jogos.map(jogo => `
                            <div class="live-game">
                                <div class="live-game-teams">
                                    <div class="live-game-team">
                                        ${jogo.logoMandante ? `<img src="${jogo.logoMandante}" alt="${jogo.mandante}">` : ''}
                                        <span>${jogo.mandante}</span>
                                    </div>
                                    <div class="live-game-score">${jogo.placar || 'vs'}</div>
                                    <div class="live-game-team">
                                        <span>${jogo.visitante}</span>
                                        ${jogo.logoVisitante ? `<img src="${jogo.logoVisitante}" alt="${jogo.visitante}">` : ''}
                                    </div>
                                </div>
                                <div class="live-game-info">
                                    <div class="live-game-time">${jogo.tempo || jogo.status || jogo.horario}</div>
                                    <div class="live-game-league">${jogo.liga || ''}</div>
                                </div>
                            </div>
                        `).join('');
                    }

                } catch (error) {
                    console.error('Erro ao carregar jogos:', error);
                    document.getElementById('live-games').innerHTML = `
                        <div class="no-games">
                            <span class="material-icons">error</span>
                            <p>Erro ao carregar jogos</p>
                        </div>
                    `;
                } finally {
                    btn.classList.remove('loading');
                }
            }

            // Inicializar
            document.addEventListener("DOMContentLoaded", () => {
                loadLayout();
                carregarStatus();
                carregarJogos();

                // Auto-refresh a cada 60 segundos
                setInterval(() => {
                    carregarStatus();
                    carregarJogos();
                }, 60000);
            });
        </script>
    </body>
</html>
