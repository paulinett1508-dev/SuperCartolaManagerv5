<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Detalhe da Liga - Super Cartola Manager</title>
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="style.css" />

        <!-- ‚úÖ CSS ESPEC√çFICO DA P√ÅGINA - REMOVIDO CSS CONFLITANTE DE NAVEGA√á√ÉO -->
        <style>
            /* === ESTILOS ESPEC√çFICOS DO DETALHE DA LIGA === */
            .page-content {
                background: #1a1a1a;
                min-height: calc(100vh - 100px);
                padding: 20px;
            }

            .liga-header {
                margin-bottom: 20px;
                background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
                border-radius: 16px;
                padding: 30px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                border: 1px solid rgba(255, 69, 0, 0.2);
            }

            .liga-titulo {
                color: #ffffff;
                margin-bottom: 5px;
                font-size: 28px;
                font-weight: 700;
            }

            .liga-info {
                color: #a0a0a0;
                margin: 0;
                font-size: 16px;
            }

            .tabs-nav {
                display: flex;
                border-bottom: 2px solid rgba(255, 69, 0, 0.2);
                margin-bottom: 30px;
                flex-wrap: wrap;
                background: rgba(42, 42, 42, 0.5);
                border-radius: 12px 12px 0 0;
                overflow-x: auto;
            }

            .tab-button {
                background: none;
                border: none;
                padding: 15px 20px;
                cursor: pointer;
                border-bottom: 3px solid transparent;
                color: #a0a0a0;
                font-weight: 600;
                font-size: 14px;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
                white-space: nowrap;
            }

            .tab-button:hover {
                background: rgba(255, 69, 0, 0.1);
                color: #ffffff;
            }

            .tab-button.active {
                border-bottom-color: #ff4500;
                color: #ff4500;
                background: rgba(255, 69, 0, 0.15);
            }

            .tab-pane {
                display: none;
                background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
                border-radius: 16px;
                padding: 30px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                border: 1px solid rgba(255, 69, 0, 0.2);
            }

            .tab-pane.active {
                display: block;
            }

            .ranking-table {
                width: 100%;
                border-collapse: collapse;
                background: rgba(26, 26, 26, 0.8);
                border-radius: 12px;
                overflow: hidden;
            }

            .ranking-table th,
            .ranking-table td {
                padding: 12px 15px;
                text-align: left;
                border-bottom: 1px solid rgba(255, 69, 0, 0.1);
                color: #ffffff;
            }

            .ranking-table th {
                background: rgba(255, 69, 0, 0.2);
                font-weight: 700;
                color: #ff4500;
                text-transform: uppercase;
                font-size: 12px;
                letter-spacing: 1px;
            }

            .ranking-table td {
                color: #e0e0e0;
            }

            .form-control {
                background: rgba(42, 42, 42, 0.8);
                border: 2px solid rgba(255, 69, 0, 0.2);
                color: #ffffff;
                border-radius: 8px;
                padding: 12px 15px;
                font-size: 14px;
            }

            .form-control:focus {
                border-color: #ff4500;
                box-shadow: 0 0 0 0.2rem rgba(255, 69, 0, 0.25);
                background: rgba(42, 42, 42, 1);
            }

            .form-control option {
                background: #2a2a2a;
                color: #ffffff;
            }

            /* Responsividade */
            @media (max-width: 768px) {
                .tabs-nav {
                    flex-direction: column;
                }

                .tab-button {
                    padding: 12px 15px;
                    font-size: 13px;
                }

                .page-content {
                    padding: 15px;
                }

                .liga-header,
                .tab-pane {
                    padding: 20px;
                }
            }
        </style>

        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>

    <body>
        <div class="app-container">
            <!-- ‚úÖ CORRIGIDO: Placeholders para inje√ß√£o do layout -->
            <div id="sidebar-placeholder"></div>

            <!-- Conte√∫do principal -->
            <main class="app-main">
                <!-- ‚úÖ CORRIGIDO: Header ser√° injetado aqui -->
                <div id="header-placeholder"></div>

                <!-- Conte√∫do da p√°gina -->
                <div class="page-content">
                    <div class="liga-header mb-4">
                        <h2 id="nomeLiga" class="liga-titulo">Nome da Liga</h2>
                        <p id="quantidadeTimes" class="liga-info">
                            0 participantes
                        </p>
                        <!-- ‚úÖ STATUS DE CARREGAMENTO EM TEMPO REAL -->
                        <div
                            id="statusCarregamento"
                            style="
                                font-size: 12px;
                                color: #666;
                                margin-top: 10px;
                                display: none;
                            "
                        >
                            <span id="statusTexto">Processando dados...</span>
                            <div
                                style="
                                    width: 100%;
                                    background: #333;
                                    border-radius: 5px;
                                    height: 4px;
                                    margin-top: 5px;
                                "
                            >
                                <div
                                    id="progressBar"
                                    style="
                                        width: 0%;
                                        background: #ff4500;
                                        height: 100%;
                                        border-radius: 5px;
                                        transition: width 0.3s;
                                    "
                                ></div>
                            </div>
                        </div>
                    </div>

                    <div class="tabs-container">
                        <nav class="tabs-nav">
                            <button
                                class="tab-button active"
                                data-tab="ranking-geral"
                            >
                                <i data-lucide="trophy"></i>
                                Ranking Geral
                            </button>
                            <button class="tab-button" data-tab="rodadas">
                                <i data-lucide="calendar"></i>
                                Rodadas
                            </button>
                            <button class="tab-button" data-tab="mata-mata">
                                <i data-lucide="zap"></i>
                                Mata-Mata
                            </button>
                            <button
                                class="tab-button"
                                data-tab="pontos-corridos"
                            >
                                <i data-lucide="trending-up"></i>
                                Pontos Corridos
                            </button>
                            <button class="tab-button" data-tab="luva-de-ouro">
                                <i data-lucide="award"></i>
                                Luva de Ouro
                            </button>
                            <button
                                class="tab-button"
                                data-tab="artilheiro-campeao"
                            >
                                <i data-lucide="target"></i>
                                Artilheiro Campe√£o
                            </button>
                            <button class="tab-button" data-tab="melhor-mes">
                                <i data-lucide="star"></i>
                                Melhor M√™s
                            </button>
                            <button class="tab-button" data-tab="top10">
                                <i data-lucide="crown"></i>
                                Top 10
                            </button>
                            <button
                                class="tab-button"
                                data-tab="fluxo-financeiro"
                            >
                                <i data-lucide="dollar-sign"></i>
                                Fluxo Financeiro
                            </button>
                        </nav>

                        <div class="tab-content">
                            <!-- Ranking Geral Tab -->
                            <div id="ranking-geral" class="tab-pane active">
                                <!-- ‚úÖ CONTAINER COM ID QUE RANKING.JS ESPERA -->
                                <div id="rankingContainer">
                                    <div
                                        id="rankingGeralLoading"
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        üîÑ Carregando ranking geral...
                                        <br /><br />
                                        <button
                                            onclick="window.forceRankingRender()"
                                            style="
                                                background: #ff4500;
                                                color: white;
                                                border: none;
                                                padding: 10px 20px;
                                                border-radius: 5px;
                                                cursor: pointer;
                                                margin-top: 10px;
                                            "
                                        >
                                            üéØ For√ßar Exibi√ß√£o
                                        </button>
                                        <br /><br />
                                        <small style="color: #666"
                                            >Se o ranking n√£o aparecer
                                            automaticamente, clique no bot√£o
                                            acima</small
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- Rodadas Tab -->
                            <div id="rodadas" class="tab-pane">
                                <div class="rodadas-controls mb-3">
                                    <div class="row align-items-center">
                                        <div class="col-md-6">
                                            <select
                                                id="rodadaSelect"
                                                class="form-control"
                                            >
                                                <option value="">
                                                    Escolha uma rodada
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 text-end">
                                            <div
                                                id="rodadasExportBtnContainer"
                                            ></div>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    id="loading"
                                    style="
                                        display: none;
                                        text-align: center;
                                        padding: 40px;
                                        color: #a0a0a0;
                                    "
                                >
                                    Carregando dados da rodada...
                                </div>

                                <div class="table-responsive">
                                    <table
                                        class="table table-striped ranking-table"
                                    >
                                        <thead>
                                            <tr>
                                                <th style="width: 60px">Pos</th>
                                                <th style="width: 50px">‚ù§Ô∏è</th>
                                                <th style="min-width: 120px">
                                                    Cartoleiro
                                                </th>
                                                <th style="min-width: 120px">
                                                    Time
                                                </th>
                                                <th style="width: 80px">
                                                    Pontos
                                                </th>
                                                <th style="width: 80px">
                                                    Banco
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="rankingBody">
                                            <tr>
                                                <td
                                                    colspan="6"
                                                    style="
                                                        color: #a0a0a0;
                                                        text-align: center;
                                                        padding: 20px;
                                                    "
                                                >
                                                    Selecione uma rodada para
                                                    visualizar o ranking.
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Mata-Mata Tab -->
                            <div id="mata-mata" class="tab-pane">
                                <div id="mataMataContent">
                                    <div
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        Clique para carregar dados do
                                        Mata-Mata...
                                    </div>
                                </div>
                            </div>

                            <!-- Pontos Corridos Tab -->
                            <div id="pontos-corridos" class="tab-pane">
                                <div id="pontosCorridosContent">
                                    <div
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        Clique para carregar dados dos Pontos
                                        Corridos...
                                    </div>
                                </div>
                            </div>

                            <!-- Luva de Ouro Tab -->
                            <div id="luva-de-ouro" class="tab-pane">
                                <div id="luvaDeOuroContent">
                                    <div
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        Clique para carregar dados da Luva de
                                        Ouro...
                                    </div>
                                </div>
                            </div>

                            <!-- Artilheiro Campe√£o Tab -->
                            <div id="artilheiro-campeao" class="tab-pane">
                                <div id="artilheiroCampeaoContent">
                                    <div
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        Clique para carregar dados do Artilheiro
                                        Campe√£o...
                                    </div>
                                </div>
                            </div>

                            <!-- Melhor M√™s Tab -->
                            <div id="melhor-mes" class="tab-pane">
                                <div id="melhorMesContent">
                                    <div
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        Clique para carregar dados do Melhor
                                        M√™s...
                                    </div>
                                </div>
                            </div>

                            <!-- Top 10 Tab -->
                            <div id="top10" class="tab-pane">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div
                                            id="top10MitosExportBtnContainer"
                                            class="text-end mb-2"
                                        ></div>
                                        <div id="top10MitosTable"></div>
                                    </div>
                                    <div class="col-md-6">
                                        <div
                                            id="top10MicosExportBtnContainer"
                                            class="text-end mb-2"
                                        ></div>
                                        <div id="top10MicosTable"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Fluxo Financeiro Tab -->
                            <div id="fluxo-financeiro" class="tab-pane">
                                <div id="fluxoFinanceiroContent">
                                    <div
                                        style="
                                            color: #a0a0a0;
                                            text-align: center;
                                            padding: 40px;
                                        "
                                    >
                                        Clique para carregar dados do Fluxo
                                        Financeiro...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- ‚úÖ SISTEMA DE M√ìDULOS - CARREGAR PRIMEIRO -->
        <script src="js/sistema-modulos-init.js"></script>

        <!-- Scripts base do sistema -->
        <script type="module" src="js/utils.js"></script>
        <script type="module" src="js/navigation.js"></script>

        <!-- Scripts de funcionalidades -->
        <script type="module" src="js/participantes.js"></script>
        <script type="module" src="js/ranking.js"></script>
        <script type="module" src="js/rodadas.js"></script>

        <!-- Scripts de m√≥dulos espec√≠ficos -->
        <script type="module" src="js/mata-mata.js"></script>
        <script type="module" src="js/pontos-corridos.js"></script>
        <script type="module" src="js/pontos-corridos-utils.js"></script>
        <script type="module" src="js/luva-de-ouro.js"></script>
        <script type="module" src="js/artilheiro-campeao.js"></script>
        <script type="module" src="js/melhor-mes.js"></script>
        <script type="module" src="js/top10.js"></script>
        <script type="module" src="js/fluxo-financeiro.js"></script>

        <!-- Scripts auxiliares -->
        <script type="module" src="js/gols.js"></script>
        <script type="module" src="js/gols-por-rodada.js"></script>
        <script type="module" src="js/liga-modificacoes.js"></script>
        <script type="module" src="js/filtro-liga-especial.js"></script>
        <script type="module" src="js/gerenciar-ligas.js"></script>

        <!-- Seletor de ligas (IIFE - n√£o precisa de type="module") -->
        <script src="js/seletor-ligas.js"></script>

        <!-- ‚úÖ CORRE√á√ÉO PRINCIPAL: Sistema de carregamento de layout -->
        <script type="module">
            import { carregarLigas } from "./js/gerenciar-ligas.js";

            // ‚úÖ FUN√á√ÉO DE CARREGAMENTO DO LAYOUT (ID√äNTICA AO DASHBOARD)
            async function loadLayout() {
                try {
                    console.log("üîÑ [DETALHE-LIGA] Carregando layout...");

                    const response = await fetch("layout.html");
                    const layoutHtml = await response.text();

                    // Parse do HTML
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(layoutHtml, "text/html");

                    // Injetar sidebar
                    const sidebar = doc.querySelector(".app-sidebar");
                    if (sidebar) {
                        document
                            .getElementById("sidebar-placeholder")
                            .replaceWith(sidebar);
                        console.log("‚úÖ [DETALHE-LIGA] Sidebar carregada");
                    }

                    // Injetar header
                    const header = doc.querySelector(".page-header");
                    if (header) {
                        document
                            .getElementById("header-placeholder")
                            .replaceWith(header);
                        console.log("‚úÖ [DETALHE-LIGA] Header carregado");
                    }

                    // Executar scripts do layout
                    const scripts = doc.querySelectorAll("script");
                    scripts.forEach((script) => {
                        if (script.textContent.trim()) {
                            const newScript = document.createElement("script");
                            newScript.textContent = script.textContent;
                            document.head.appendChild(newScript);
                        }
                    });

                    console.log("‚úÖ [DETALHE-LIGA] Layout completamente carregado");
                } catch (error) {
                    console.error("‚ùå [DETALHE-LIGA] Erro ao carregar layout:", error);
                }
            }

            // ‚úÖ SISTEMA DE TABS FUNCIONAL
            async function initializeTabs() {
                console.log("üîß [DETALHE-LIGA] Inicializando sistema de tabs...");

                const tabButtons = document.querySelectorAll(".tab-button");
                const tabPanes = document.querySelectorAll(".tab-pane");

                // ‚úÖ CARREGAR M√ìDULOS E EXPOR FUN√á√ïES GLOBALMENTE
                const modules = {};

                try {
                    // Importar todos os m√≥dulos necess√°rios
                    modules.ranking = await import("./js/ranking.js");
                    modules.rodadas = await import("./js/rodadas.js");
                    modules.mataMata = await import("./js/mata-mata.js");
                    modules.pontosCorreidos = await import("./js/pontos-corridos.js");
                    modules.luvaDeOuro = await import("./js/luva-de-ouro.js");
                    modules.artilheiroCampeao = await import("./js/artilheiro-campeao.js");
                    modules.melhorMes = await import("./js/melhor-mes.js");
                    modules.top10 = await import("./js/top10.js");
                    modules.fluxoFinanceiro = await import("./js/fluxo-financeiro.js");

                    console.log("‚úÖ [DETALHE-LIGA] M√≥dulos carregados:", Object.keys(modules));
                } catch (error) {
                    console.error("‚ùå [DETALHE-LIGA] Erro ao carregar m√≥dulos:", error);
                }

                tabButtons.forEach((button) => {
                    button.addEventListener("click", async function () {
                        const tabId = this.getAttribute("data-tab");
                        console.log(`üîß [DETALHE-LIGA] Mudando para tab: ${tabId}`);

                        // Atualizar UI das tabs
                        tabButtons.forEach((btn) => btn.classList.remove("active"));
                        tabPanes.forEach((pane) => pane.classList.remove("active"));

                        this.classList.add("active");
                        const targetPane = document.getElementById(tabId);
                        if (targetPane) {
                            targetPane.classList.add("active");
                            await loadTabContent(tabId, modules);
                        }
                    });
                });

                // ‚úÖ CARREGAR CONTE√öDO INICIAL (Ranking Geral)
                await loadTabContent("ranking-geral", modules);

                // ‚úÖ MONITORAR DADOS DE RANKING A CADA 3 SEGUNDOS
                const rankingMonitor = setInterval(() => {
                    const hasVisibleTable = document.getElementById("rankingGeralTableContainer")?.style.display !== "none";
                    if (!hasVisibleTable) {
                        forceRankingRender();
                    } else {
                        clearInterval(rankingMonitor);
                        console.log("‚úÖ [DETALHE-LIGA] Monitor de ranking interrompido - tabela vis√≠vel");
                    }
                }, 3000);

                // Parar monitor ap√≥s 30 segundos
                setTimeout(() => {
                    clearInterval(rankingMonitor);
                    console.log("‚è∞ [DETALHE-LIGA] Monitor de ranking finalizado por timeout");
                }, 30000);
            }

            // ‚úÖ CARREGAMENTO DE CONTE√öDO POR TAB
            async function loadTabContent(tabId, modules) {
                try {
                    console.log(`üìä [DETALHE-LIGA] Carregando conte√∫do: ${tabId}`);

                    const urlParams = new URLSearchParams(window.location.search);
                    const ligaId = urlParams.get("id");

                    if (!ligaId) {
                        console.warn("‚ö†Ô∏è [DETALHE-LIGA] ID da liga n√£o encontrado");
                        return;
                    }

                    switch (tabId) {
                        case "ranking-geral":
                            if (modules.ranking?.carregarRankingGeral) {
                                await modules.ranking.carregarRankingGeral();
                            } else if (modules.ranking?.carregarRanking) {
                                await modules.ranking.carregarRanking();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de ranking n√£o encontrada");
                                document.getElementById("ranking-geral").innerHTML = `
                                    <div style="text-align: center; padding: 40px; color: #a0a0a0;">
                                        <p>M√≥dulo de ranking n√£o dispon√≠vel</p>
                                        <button onclick="window.location.reload()" style="background: #ff4500; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                            üîÑ Recarregar P√°gina
                                        </button>
                                    </div>
                                `;
                            }

                            // ‚úÖ FOR√áAR RENDERIZA√á√ÉO SE DADOS EXISTIREM
                            setTimeout(() => {
                                forceRankingRender();
                            }, 2000);
                            break;

                        case "rodadas":
                            if (modules.rodadas?.carregarRodadas) {
                                await modules.rodadas.carregarRodadas();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de rodadas n√£o encontrada");
                            }
                            break;

                        case "mata-mata":
                            if (modules.mataMata?.carregarMataMata) {
                                await modules.mataMata.carregarMataMata();
                            } else if (modules.mataMata?.inicializarMataMata) {
                                await modules.mataMata.inicializarMataMata();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de mata-mata n√£o encontrada");
                            }
                            break;

                        case "pontos-corridos":
                            if (modules.pontosCorreidos?.inicializarPontosCorreidos) {
                                await modules.pontosCorreidos.inicializarPontosCorreidos();
                            } else if (modules.pontosCorreidos?.carregarPontosCorreidos) {
                                await modules.pontosCorreidos.carregarPontosCorreidos();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de pontos corridos n√£o encontrada");
                            }
                            break;

                        case "luva-de-ouro":
                            if (modules.luvaDeOuro?.inicializarLuvaDeOuro) {
                                await modules.luvaDeOuro.inicializarLuvaDeOuro();
                            } else if (modules.luvaDeOuro?.carregarLuvaDeOuro) {
                                await modules.luvaDeOuro.carregarLuvaDeOuro();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de luva de ouro n√£o encontrada");
                            }
                            break;

                        case "artilheiro-campeao":
                            if (modules.artilheiroCampeao?.inicializarArtilheiroCampeao) {
                                await modules.artilheiroCampeao.inicializarArtilheiroCampeao();
                            } else if (modules.artilheiroCampeao?.carregarArtilheiroCampeao) {
                                await modules.artilheiroCampeao.carregarArtilheiroCampeao();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de artilheiro campe√£o n√£o encontrada");
                            }
                            break;

                        case "melhor-mes":
                            if (modules.melhorMes?.inicializarMelhorMes) {
                                await modules.melhorMes.inicializarMelhorMes();
                            } else if (modules.melhorMes?.carregarMelhorMes) {
                                await modules.melhorMes.carregarMelhorMes();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de melhor m√™s n√£o encontrada");
                            }
                            break;

                        case "top10":
                            if (modules.top10?.inicializarTop10) {
                                await modules.top10.inicializarTop10();
                            } else if (modules.top10?.carregarTop10) {
                                await modules.top10.carregarTop10();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de top10 n√£o encontrada");
                            }
                            break;

                        case "fluxo-financeiro":
                            if (modules.fluxoFinanceiro?.inicializarFluxoFinanceiro) {
                                await modules.fluxoFinanceiro.inicializarFluxoFinanceiro();
                            } else if (modules.fluxoFinanceiro?.carregarFluxoFinanceiro) {
                                await modules.fluxoFinanceiro.carregarFluxoFinanceiro();
                            } else {
                                console.warn("‚ö†Ô∏è Fun√ß√£o de fluxo financeiro n√£o encontrada");
                            }
                            break;

                        default:
                            console.log(`‚ÑπÔ∏è [DETALHE-LIGA] Tab ${tabId} n√£o tem fun√ß√£o espec√≠fica`);
                    }

                    console.log(`‚úÖ [DETALHE-LIGA] Conte√∫do ${tabId} carregado`);
                } catch (error) {
                    console.error(`‚ùå [DETALHE-LIGA] Erro ao carregar ${tabId}:`, error);

                    const targetPane = document.getElementById(tabId);
                    if (targetPane) {
                        targetPane.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #ff4444;">
                                <p>‚ùå Erro ao carregar ${tabId}</p>
                                <p style="font-size: 12px; color: #a0a0a0;">${error.message}</p>
                                <button onclick="window.location.reload()" style="background: #ff4500; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                                    üîÑ Recarregar P√°gina
                                </button>
                            </div>
                        `;
                    }
                }
            }

            // ‚úÖ CARREGAR DADOS DA LIGA
            async function loadLigaDetails() {
                const urlParams = new URLSearchParams(window.location.search);
                const ligaId = urlParams.get("id");

                if (!ligaId) {
                    console.warn("‚ö†Ô∏è [DETALHE-LIGA] ID da liga n√£o encontrado na URL");
                    return;
                }

                try {
                    console.log(`üìä [DETALHE-LIGA] Carregando detalhes da liga: ${ligaId}`);

                    const response = await fetch(`/api/ligas/${ligaId}`);

                    if (response.ok) {
                        const liga = await response.json();
                        updateLigaHeader(liga);
                        console.log("‚úÖ [DETALHE-LIGA] Dados da liga carregados:", liga.nome);
                    } else {
                        console.warn("‚ö†Ô∏è [DETALHE-LIGA] API da liga falhou, usando fallback");
                        await loadFallbackData(ligaId);
                    }
                } catch (error) {
                    console.error("‚ùå [DETALHE-LIGA] Erro ao carregar liga:", error);
                    await loadFallbackData(ligaId);
                }
            }

            // ‚úÖ DADOS DE FALLBACK
            async function loadFallbackData(ligaId) {
                console.log("üìÑ [DETALHE-LIGA] Carregando dados de fallback...");

                const fallbackData = {
                    "684cb1c8af923da7c7df51de": {
                        nome: "Super Cartola 2025",
                        participantes: 32,
                        status: "Ativo",
                    },
                    "684d821cf1a7ae16d1f89572": {
                        nome: "Cartoleiros Sobral 2025",
                        participantes: 6,
                        status: "Ativo",
                    },
                };

                const dados = fallbackData[ligaId] || {
                    nome: "Liga Desconhecida",
                    participantes: 0,
                    status: "Carregando...",
                };

                updateLigaHeader(dados);
                console.log(`‚úÖ [DETALHE-LIGA] Fallback carregado para: ${dados.nome}`);
            }

            // ‚úÖ FOR√áAR RENDERIZA√á√ÉO DO RANKING
            function forceRankingRender() {
                console.log("üîÑ [DETALHE-LIGA] For√ßando renderiza√ß√£o do ranking...");

                // Verificar se existem dados globais de ranking
                const possibleData = [
                    window.rankingData,
                    window.rankingGeral,
                    window.dadosRanking,
                    window.ultimoRanking
                ];

                let rankingData = null;
                for (const data of possibleData) {
                    if (data && Array.isArray(data) && data.length > 0) {
                        rankingData = data;
                        console.log(`‚úÖ [DETALHE-LIGA] Dados encontrados:`, data.length, "registros");
                        break;
                    }
                }

                if (!rankingData) {
                    console.log("‚ö†Ô∏è [DETALHE-LIGA] Nenhum dado de ranking encontrado para for√ßar renderiza√ß√£o");
                    return;
                }

                // Renderizar tabela manualmente
                const tableBody = document.getElementById("rankingGeralTableBody");
                const tableContainer = document.getElementById("rankingGeralTableContainer");
                const loadingDiv = document.getElementById("rankingGeralLoading");

                if (!tableBody) {
                    console.error("‚ùå [DETALHE-LIGA] Elemento rankingGeralTableBody n√£o encontrado");
                    return;
                }

                console.log("üéØ [DETALHE-LIGA] Renderizando", rankingData.length, "registros na tabela");

                // Limpar tabela
                tableBody.innerHTML = '';

                // Ordenar por pontos (decrescente)
                const sortedData = [...rankingData].sort((a, b) => {
                    const pontosA = parseFloat(a.pontos_total || a.pontos || 0);
                    const pontosB = parseFloat(b.pontos_total || b.pontos || 0);
                    return pontosB - pontosA;
                });

                // Renderizar linhas
                sortedData.forEach((item, index) => {
                    const posicao = index + 1;
                    const nome = item.nome || item.cartoleiro || item.participante || 'N/A';
                    const time = item.time || item.nome_time || 'Time';
                    const pontos = parseFloat(item.pontos_total || item.pontos || 0).toFixed(2);
                    const media = parseFloat(item.media || pontos / 20 || 0).toFixed(2);
                    const rodadas = item.rodadas || 20;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${posicao}¬∫</strong></td>
                        <td>‚ù§Ô∏è</td>
                        <td><strong style="color: #ffffff;">${nome}</strong></td>
                        <td style="color: #a0a0a0;">${time}</td>
                        <td><strong style="color: #ff4500;">${pontos}</strong></td>
                        <td style="color: #a0a0a0;">${media}</td>
                        <td style="color: #666;">${rodadas}</td>
                    `;

                    // Destacar top 3
                    if (posicao === 1) {
                        row.style.background = 'rgba(255, 215, 0, 0.1)';
                        row.style.borderLeft = '4px solid gold';
                    } else if (posicao === 2) {
                        row.style.background = 'rgba(192, 192, 192, 0.1)';
                        row.style.borderLeft = '4px solid silver';
                    } else if (posicao === 3) {
                        row.style.background = 'rgba(205, 127, 50, 0.1)';
                        row.style.borderLeft = '4px solid #cd7f32';
                    }

                    tableBody.appendChild(row);
                });

                // Mostrar tabela e esconder loading
                if (tableContainer) {
                    tableContainer.style.display = 'block';
                }
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }

                console.log("‚úÖ [DETALHE-LIGA] Tabela renderizada com sucesso!");
            }

            // ‚úÖ FUN√á√ÉO GLOBAL PARA DEBUG
            window.forceRankingRender = forceRankingRender;
                const nomeElement = document.getElementById("nomeLiga");
                const quantidadeElement = document.getElementById("quantidadeTimes");

                if (nomeElement) {
                    nomeElement.textContent = liga.nome || "Nome da Liga";
                }

                if (quantidadeElement) {
                    const participantes = liga.participantes || liga.times?.length || 0;
                    quantidadeElement.textContent = `${participantes} participantes`;
                }

                console.log(`‚úÖ [DETALHE-LIGA] Header atualizado: ${liga.nome} (${liga.participantes || 0} participantes)`);
            }

            // ‚úÖ INTERCEPTAR CONSOLE.LOG PARA DETECTAR RANKING CALCULADO
            const originalConsoleLog = console.log;
            let rodadasProcessadas = 0;
            const totalRodadas = 20;

            console.log = function(...args) {
                originalConsoleLog.apply(console, args);

                const message = args.join(' ');

                // Monitorar progresso das rodadas
                if (message.includes('times encontrados') && message.includes('Rodada')) {
                    rodadasProcessadas++;
                    updateProgressStatus(rodadasProcessadas, totalRodadas);
                }

                // Detectar ranking calculado
                if (message.includes('Ranking final calculado') ||
                    message.includes('ranking geral') ||
                    message.includes('times encontrados')) {

                    console.log("üéØ [DETALHE-LIGA] Interceptou mensagem de ranking:", message);
                    setTimeout(() => forceRankingRender(), 500);
                }
            };

            // ‚úÖ ATUALIZAR STATUS DE PROGRESSO
            function updateProgressStatus(atual, total) {
                const statusDiv = document.getElementById("statusCarregamento");
                const statusTexto = document.getElementById("statusTexto");
                const progressBar = document.getElementById("progressBar");

                if (statusDiv && statusTexto && progressBar) {
                    statusDiv.style.display = "block";
                    statusTexto.textContent = `Processando rodada ${atual} de ${total}...`;
                    const percent = (atual / total) * 100;
                    progressBar.style.width = percent + "%";

                    if (atual >= total) {
                        setTimeout(() => {
                            statusTexto.textContent = "‚úÖ Dados processados - Montando tabela...";
                            progressBar.style.width = "100%";
                            progressBar.style.background = "#22c55e";

                            setTimeout(() => {
                                statusDiv.style.display = "none";
                            }, 3000);
                        }, 1000);
                    }
                }
            }

            // ‚úÖ INICIALIZA√á√ÉO PRINCIPAL
            document.addEventListener("DOMContentLoaded", async function () {
                console.log("üöÄ [DETALHE-LIGA] Iniciando sistema...");

                try {
                    // 1. Carregar layout PRIMEIRO
                    await loadLayout();

                    // 2. Aguardar um pouco para o layout se estabelecer
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // 3. Carregar detalhes da liga
                    await loadLigaDetails();

                    // 4. Inicializar sistema de tabs
                    await initializeTabs();

                    console.log("‚úÖ [DETALHE-LIGA] Sistema inicializado com sucesso");
                } catch (error) {
                    console.error("‚ùå [DETALHE-LIGA] Erro na inicializa√ß√£o:", error);
                }
            });

            // ‚úÖ FUN√á√ïES GLOBAIS PARA DEBUG E FALLBACK
            window.debugRanking = function() {
                console.log("üîç [DEBUG] Verificando dados de ranking...");
                console.log("window.rankingData:", window.rankingData);
                console.log("window.rankingGeral:", window.rankingGeral);
                console.log("window.dadosRanking:", window.dadosRanking);
                console.log("window.ultimoRanking:", window.ultimoRanking);
                console.log("Elementos DOM:", {
                    tableBody: document.getElementById("rankingGeralTableBody"),
                    tableContainer: document.getElementById("rankingGeralTableContainer"),
                    loading: document.getElementById("rankingGeralLoading")
                });
            };

            window.manualRankingRender = function(data) {
                console.log("üîß [MANUAL] Renderiza√ß√£o manual iniciada...");
                if (data && Array.isArray(data)) {
                    window.rankingData = data;
                    forceRankingRender();
                } else {
                    console.log("‚ö†Ô∏è Forne√ßa dados: window.manualRankingRender([{nome: 'Time', pontos: 100}, ...])");
                }
            };

            console.log("üéÆ [DETALHE-LIGA] Fun√ß√µes debug dispon√≠veis:");
            console.log("- window.forceRankingRender() - For√ßar renderiza√ß√£o");
            console.log("- window.debugRanking() - Ver estado dos dados");
            console.log("- window.manualRankingRender(dados) - Renderiza√ß√£o manual");
        </script>
    </body>
</html>
