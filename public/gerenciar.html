<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Gerenciar Ligas - Super Cartola Manager</title>
        <link rel="stylesheet" href="style.css" />
        <style>
            .app-main {
                padding-top: 20px; /* Compensar aus√™ncia do header */
            }

            .admin-container {
                background: #1a1a1a;
                min-height: calc(100vh - 100px);
            }

            .admin-section {
                background: #2a2a2a;
                border-radius: 12px;
                padding: 25px;
                margin-bottom: 25px;
                border: 1px solid rgba(255, 69, 0, 0.2);
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            }

            .admin-section h3 {
                color: #ff4500;
                font-size: 18px;
                font-weight: 700;
                margin: 0 0 20px 0;
                padding-bottom: 12px;
                border-bottom: 2px solid rgba(255, 69, 0, 0.3);
            }

            .admin-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }

            .admin-tool {
                background: #1e1e1e;
                border-radius: 8px;
                padding: 20px;
                border: 1px solid #333333;
                transition: all 0.3s ease;
            }

            .admin-tool:hover {
                transform: translateY(-2px);
                border-color: #ff4500;
                box-shadow: 0 4px 15px rgba(255, 69, 0, 0.2);
            }

            .admin-tool h4 {
                color: #ffffff;
                font-size: 16px;
                margin: 0 0 10px 0;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .admin-tool p {
                color: #a0a0a0;
                font-size: 13px;
                margin: 0 0 15px 0;
                line-height: 1.4;
            }

            .admin-btn {
                background: linear-gradient(135deg, #ff4500 0%, #e8472b 100%);
                color: white;
                padding: 12px 18px;
                border: none;
                border-radius: 6px;
                font-weight: 600;
                font-size: 13px;
                cursor: pointer;
                text-decoration: none;
                display: inline-block;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(255, 69, 0, 0.3);
            }

            .admin-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(255, 69, 0, 0.4);
            }

            .admin-btn.success {
                background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
                box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
            }

            .admin-btn.danger {
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            }

            .admin-btn.info {
                background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            }

            .liga-list {
                background: #1e1e1e;
                border-radius: 8px;
                border: 1px solid #333333;
                overflow: hidden;
            }

            .liga-list-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 15px 20px;
                border-bottom: 1px solid #333333;
                transition: all 0.2s ease;
            }

            .liga-list-item:hover {
                background: rgba(255, 69, 0, 0.05);
            }

            .liga-list-item:last-child {
                border-bottom: none;
            }

            .liga-list-info h4 {
                color: #ffffff;
                font-size: 14px;
                margin: 0 0 4px 0;
                font-weight: 600;
            }

            .liga-list-info p {
                color: #a0a0a0;
                font-size: 12px;
                margin: 0;
            }

            .liga-list-actions {
                display: flex;
                gap: 8px;
            }

            .liga-list-actions .admin-btn {
                padding: 8px 12px;
                font-size: 11px;
            }

            .search-admin {
                margin-bottom: 20px;
            }

            .search-admin input {
                width: 100%;
                padding: 12px 16px;
                background: #1a1a1a;
                border: 1px solid #333333;
                border-radius: 8px;
                color: #ffffff;
                font-size: 14px;
                outline: none;
                transition: all 0.3s ease;
            }

            .search-admin input:focus {
                border-color: #ff4500;
                box-shadow: 0 0 0 2px rgba(255, 69, 0, 0.2);
            }

            .search-admin input::placeholder {
                color: #606060;
            }

            @media (max-width: 768px) {
                .admin-grid {
                    grid-template-columns: 1fr;
                    gap: 15px;
                }

                .liga-list-item {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 12px;
                }

                .liga-list-actions {
                    width: 100%;
                    justify-content: flex-start;
                }
            }
        </style>
    </head>
    <body>
        <div class="app-container">
            <!-- Sidebar ser√° injetado aqui -->
            <div id="sidebar-placeholder"></div>

            <!-- Conte√∫do principal -->
            <main class="app-main">
                <!-- Conte√∫do da p√°gina -->
                <div class="page-content" style="padding-top: 0">
                    <div class="admin-container">
                        <!-- Ferramentas Administrativas -->
                        <div class="admin-section">
                            <div class="admin-grid">
                                <div class="admin-tool">
                                    <h4>‚ûï Criar Liga</h4>
                                    <p>
                                        Criar uma nova liga do Cartola FC com
                                        configura√ß√µes personalizadas.
                                    </p>
                                    <a
                                        href="preencher-liga.html"
                                        class="admin-btn success"
                                    >
                                        Criar Nova Liga
                                    </a>
                                </div>

                                <div class="admin-tool">
                                    <h4>üîç Buscar Times</h4>
                                    <p>
                                        Encontrar e adicionar times do Cartola
                                        FC √†s suas ligas.
                                    </p>
                                    <a
                                        href="buscar-times.html"
                                        class="admin-btn info"
                                    >
                                        Buscar Times
                                    </a>
                                </div>

                                <div class="admin-tool">
                                    <h4>‚öôÔ∏è Popular Rodadas</h4>
                                    <p>
                                        Sincronizar dados das rodadas com a API
                                        oficial do Cartola FC.
                                    </p>
                                    <a href="admin.html" class="admin-btn">
                                        Administra√ß√£o
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Lista Administrativa de Ligas -->
                        <div class="admin-section">
                            <h3>üìã Lista Administrativa</h3>

                            <div class="search-admin">
                                <input
                                    type="text"
                                    id="searchAdminInput"
                                    placeholder="Buscar liga para gerenciar..."
                                    oninput="filtrarListaAdmin()"
                                />
                            </div>

                            <div id="ligasListAdmin">
                                <div class="loading">
                                    Carregando lista de ligas...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <script type="module">
            import {
                carregarLigas,
                deletarLiga,
            } from "./js/gerenciar-ligas.js";

            let ligasAdmin = [];

            // === CARREGAR LAYOUT ===
            async function loadLayout() {
                try {
                    const response = await fetch("layout.html");
                    const layoutHtml = await response.text();

                    const parser = new DOMParser();
                    const doc = parser.parseFromString(layoutHtml, "text/html");

                    // Injetar sidebar
                    const sidebar = doc.querySelector(".app-sidebar");
                    if (sidebar) {
                        document
                            .getElementById("sidebar-placeholder")
                            .replaceWith(sidebar);
                    }

                    // N√£o injetar header - p√°gina admin sem header de estat√≠sticas

                    // Executar scripts do layout
                    const scripts = doc.querySelectorAll("script");
                    scripts.forEach((script) => {
                        if (script.textContent.trim()) {
                            const newScript = document.createElement("script");
                            newScript.textContent = script.textContent;
                            document.head.appendChild(newScript);
                        }
                    });
                } catch (error) {
                    console.error("Erro ao carregar layout:", error);
                }
            }

            // === CARREGAR LISTA ADMINISTRATIVA ===
            async function carregarListaAdmin() {
                const container = document.getElementById("ligasListAdmin");

                try {
                    ligasAdmin = await carregarLigas();

                    if (ligasAdmin.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #a0a0a0;">
                                üìã Nenhuma liga criada ainda
                            </div>
                        `;
                        return;
                    }

                    renderizarListaAdmin(ligasAdmin);
                } catch (error) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #ef4444;">
                            ‚ö†Ô∏è Erro ao carregar: ${error.message}
                        </div>
                    `;
                }
            }

            // === RENDERIZAR LISTA ADMIN ===
            function renderizarListaAdmin(ligas) {
                const container = document.getElementById("ligasListAdmin");

                const ligasHtml = `
                    <div class="liga-list">
                        ${ligas
                            .map((liga) => {
                                const timesCount = liga.times
                                    ? liga.times.length
                                    : 0;
                                const idCurto = liga._id.substring(0, 8);

                                return `
                                <div class="liga-list-item" data-liga-id="${liga._id}">
                                    <div class="liga-list-info">
                                        <h4>${liga.nome}</h4>
                                        <p>ID: ${idCurto} ‚Ä¢ ${timesCount} participantes</p>
                                    </div>
                                    <div class="liga-list-actions">
                                        <a href="editar-liga.html?id=${liga._id}" class="admin-btn success">
                                            ‚úèÔ∏è Editar
                                        </a>
                                        <a href="fronts/admin-rodadas.html?id=${liga._id}" class="admin-btn">
                                            ‚öôÔ∏è Popular Rodadas
                                        </a>
                                        <button class="admin-btn danger" 
                                                onclick="excluirLigaAdmin('${liga._id}', '${liga.nome}')">
                                            üóëÔ∏è Excluir
                                        </button>
                                    </div>
                                </div>
                            `;
                            })
                            .join("")}
                    </div>
                `;

                container.innerHTML = ligasHtml;
            }

            // === FILTRO LISTA ADMIN ===
            window.filtrarListaAdmin = function () {
                const searchTerm = document
                    .getElementById("searchAdminInput")
                    .value.toLowerCase()
                    .trim();
                const ligaItems = document.querySelectorAll(".liga-list-item");

                ligaItems.forEach((item) => {
                    const nomeLiga = item
                        .querySelector("h4")
                        .textContent.toLowerCase();
                    const infoLiga = item
                        .querySelector("p")
                        .textContent.toLowerCase();

                    const isVisible =
                        nomeLiga.includes(searchTerm) ||
                        infoLiga.includes(searchTerm);
                    item.style.display = isVisible ? "flex" : "none";
                });
            };

            // === EXCLUS√ÉO ADMINISTRATIVA ===
            window.excluirLigaAdmin = async function (id, nome) {
                const confirmacao = confirm(
                    `‚ö†Ô∏è EXCLUS√ÉO ADMINISTRATIVA\n\n` +
                        `Confirma exclus√£o da liga "${nome}"?\n\n` +
                        `Esta opera√ß√£o √© irrevers√≠vel.`,
                );

                if (!confirmacao) return;

                try {
                    await deletarLiga(id);
                    await carregarListaAdmin(); // Recarregar lista
                } catch (error) {
                    alert(`‚ùå Erro ao excluir: ${error.message}`);
                }
            };

            // === INICIALIZA√á√ÉO ===
            document.addEventListener("DOMContentLoaded", async () => {
                await loadLayout();
                await carregarListaAdmin();
            });
        </script>
    </body>
</html>
