// SUBSTITUIR A FUNÇÃO exportarExtrato() - LINHAS 203-268

async function exportarExtrato(extrato, participante, timeId) {
    try {
        await carregarExports();

        if (!exportarExtratoFinanceiroComoImagem) {
            alert("Exportação não disponível");
            return;
        }

        const camposEditaveis =
            FluxoFinanceiroCampos.carregarTodosCamposEditaveis(timeId);
        const dadosMovimentacoes = [];

        // ✅ CORREÇÃO: SEMPRE ADICIONAR TODAS AS RODADAS
        extrato.rodadas.forEach((rodada) => {
            const rodadaNumero = rodada.rodada;
            
            // Descrição da posição
            const descricao = rodada.isMito
                ? `Rodada ${rodadaNumero} - MITO`
                : rodada.isMico
                  ? `Rodada ${rodadaNumero} - MICO`
                  : `Rodada ${rodadaNumero} - Posição ${rodada.posicao}°`;
            
            // ✅ SEMPRE ADICIONA BÔNUS/ÔNUS (MESMO SE R$ 0,00)
            dadosMovimentacoes.push({
                data: `R${rodadaNumero}`,
                descricao,
                valor: rodada.bonusOnus || 0,
                tipo: "bonus_onus",
            });
            
            // ✅ SEMPRE ADICIONA PONTOS CORRIDOS (MESMO SE R$ 0,00)
            if (rodada.pontosCorridos !== null && rodada.pontosCorridos !== undefined) {
                dadosMovimentacoes.push({
                    data: `R${rodadaNumero}`,
                    descricao: `Rodada ${rodadaNumero} - Pontos Corridos`,
                    valor: rodada.pontosCorridos,
                    tipo: "pontos_corridos",
                });
            }
            
            // ✅ SEMPRE ADICIONA MATA-MATA (MESMO SE R$ 0,00)
            if (rodada.mataMata !== null && rodada.mataMata !== undefined) {
                dadosMovimentacoes.push({
                    data: `R${rodadaNumero}`,
                    descricao: `Rodada ${rodadaNumero} - Mata-Mata`,
                    valor: rodada.mataMata,
                    tipo: "mata_mata",
                });
            }
        });

        // Campos editáveis (mantido original)
        ["campo1", "campo2", "campo3", "campo4"].forEach((campo) => {
            const valorCampo = extrato.resumo[campo];
            if (valorCampo && valorCampo !== 0) {
                dadosMovimentacoes.push({
                    data: "Manual",
                    descricao:
                        camposEditaveis[campo].nome ||
                        `Campo ${campo.slice(-1)}`,
                    valor: valorCampo,
                    tipo: "campo_editavel",
                });
            }
        });

        await exportarExtratoFinanceiroComoImagem(
            dadosMovimentacoes,
            participante,
            ultimaRodadaCompleta,
        );
    } catch (error) {
        console.error("[FLUXO-FINANCEIRO] Erro na exportação:", error);
        alert(`Erro ao exportar: ${error.message}`);
    }
}