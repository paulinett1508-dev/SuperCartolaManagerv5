// CORREÃ‡ÃƒO: Aplicar cores vermelhas para perdedores no Mata-Mata
// FunÃ§Ã£o criarItemConfrontoMataMataComoImagemMobile corrigida

function criarItemConfrontoMataMataComoImagemMobile(
  confronto,
  index,
  isPending,
) {
  const { jogo, timeA, timeB } = confronto;

  // Determinar vencedor
  let vencedorA = false,
    vencedorB = false;
  if (!isPending && timeA?.pontos !== null && timeB?.pontos !== null) {
    if (timeA.pontos > timeB.pontos) {
      vencedorA = true;
    } else if (timeB.pontos > timeA.pontos) {
      vencedorB = true;
    } else {
      // CritÃ©rio de desempate por ranking (mata-mata)
      if (timeA.rankR2 < timeB.rankR2) {
        vencedorA = true;
      } else {
        vencedorB = true;
      }
    }
  }

  // Verificar goleada
  const diferenca =
    !isPending && timeA?.pontos && timeB?.pontos
      ? Math.abs(timeA.pontos - timeB.pontos)
      : 0;
  const goleada = diferenca >= 50;

  const formatarPontos = (pontos) => {
    if (isPending || pontos === null || pontos === undefined) return "-";
    return typeof pontos === "number" ? pontos.toFixed(2) : "-";
  };

  return `
    <div style="
      display: flex;
      align-items: center;
      padding: 16px ${MOBILE_DARK_HD_CONFIG.padding}px;
      border-bottom: 1px solid ${MOBILE_DARK_HD_CONFIG.colors.divider};
      ${goleada ? `border-left: 4px solid ${MOBILE_DARK_HD_CONFIG.colors.warning};` : ""}
      transition: all 0.2s ease;
    ">

      <!-- NÃºmero do Jogo -->
      <div style="
        background: ${MOBILE_DARK_HD_CONFIG.colors.warning};
        color: #000;
        padding: 8px 12px;
        border-radius: 8px;
        margin-right: 16px;
        min-width: 50px;
        text-align: center;
        font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.bold} ${MOBILE_DARK_HD_CONFIG.fonts.bodySmall};
      ">
        J${jogo}
      </div>

      <!-- Time A -->
      <div style="flex: 1; display: flex; align-items: center; gap: 12px;">
        ${
          timeA?.clube_id
            ? `
          <img src="/escudos/${timeA.clube_id}.png"
               style="
                 width: 32px; 
                 height: 32px; 
                 border-radius: 50%; 
                 border: 2px solid ${vencedorA ? MOBILE_DARK_HD_CONFIG.colors.success : vencedorB ? MOBILE_DARK_HD_CONFIG.colors.danger : MOBILE_DARK_HD_CONFIG.colors.border};
                 background: ${MOBILE_DARK_HD_CONFIG.colors.surfaceLight};
               "
               onerror="this.outerHTML='<div style=\\'width:32px;height:32px;background:${MOBILE_DARK_HD_CONFIG.colors.surfaceLight};border:2px solid ${MOBILE_DARK_HD_CONFIG.colors.border};border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;\\'>âš½</div>'"
               alt="Escudo">
        `
            : `
          <div style="
            width: 32px; 
            height: 32px; 
            background: ${MOBILE_DARK_HD_CONFIG.colors.surfaceLight}; 
            border: 2px solid ${MOBILE_DARK_HD_CONFIG.colors.border}; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px;
          ">âš½</div>
        `
        }

        <div style="flex: 1; min-width: 0;">
          <div style="
            font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.semibold} ${MOBILE_DARK_HD_CONFIG.fonts.bodySmall};
            color: ${vencedorA ? MOBILE_DARK_HD_CONFIG.colors.success : vencedorB ? MOBILE_DARK_HD_CONFIG.colors.danger : MOBILE_DARK_HD_CONFIG.colors.text};
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          ">
            ${vencedorA ? "ðŸ‘‘ " : ""}${timeA?.nome_time || "Time A"}
          </div>

          <div style="
            font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.regular} ${MOBILE_DARK_HD_CONFIG.fonts.caption};
            color: ${MOBILE_DARK_HD_CONFIG.colors.textMuted};
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          ">${timeA?.nome_cartoleiro || timeA?.nome_cartola || "N/D"}</div>
        </div>
      </div>

      <!-- PontuaÃ§Ã£o A -->
      <div style="text-align: center; margin: 0 12px;">
        <div style="
          font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.bold} ${MOBILE_DARK_HD_CONFIG.fonts.subheading};
          color: ${vencedorA ? MOBILE_DARK_HD_CONFIG.colors.success : vencedorB ? MOBILE_DARK_HD_CONFIG.colors.danger : MOBILE_DARK_HD_CONFIG.colors.text};
        ">
          ${formatarPontos(timeA?.pontos)}${goleada && vencedorA ? " ðŸ”¥" : ""}
        </div>
      </div>

      <!-- VS -->
      <div style="
        font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.bold} ${MOBILE_DARK_HD_CONFIG.fonts.bodySmall};
        color: ${MOBILE_DARK_HD_CONFIG.colors.textMuted};
        margin: 0 8px;
      ">VS</div>

      <!-- PontuaÃ§Ã£o B -->
      <div style="text-align: center; margin: 0 12px;">
        <div style="
          font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.bold} ${MOBILE_DARK_HD_CONFIG.fonts.subheading};
          color: ${vencedorB ? MOBILE_DARK_HD_CONFIG.colors.success : vencedorA ? MOBILE_DARK_HD_CONFIG.colors.danger : MOBILE_DARK_HD_CONFIG.colors.text};
        ">
          ${formatarPontos(timeB?.pontos)}${goleada && vencedorB ? " ðŸ”¥" : ""}
        </div>
      </div>

      <!-- Time B -->
      <div style="flex: 1; display: flex; align-items: center; gap: 12px; flex-direction: row-reverse;">
        ${
          timeB?.clube_id
            ? `
          <img src="/escudos/${timeB.clube_id}.png"
               style="
                 width: 32px; 
                 height: 32px; 
                 border-radius: 50%; 
                 border: 2px solid ${vencedorB ? MOBILE_DARK_HD_CONFIG.colors.success : vencedorA ? MOBILE_DARK_HD_CONFIG.colors.danger : MOBILE_DARK_HD_CONFIG.colors.border};
                 background: ${MOBILE_DARK_HD_CONFIG.colors.surfaceLight};
               "
               onerror="this.outerHTML='<div style=\\'width:32px;height:32px;background:${MOBILE_DARK_HD_CONFIG.colors.surfaceLight};border:2px solid ${MOBILE_DARK_HD_CONFIG.colors.border};border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;\\'>âš½</div>'"
               alt="Escudo">
        `
            : `
          <div style="
            width: 32px; 
            height: 32px; 
            background: ${MOBILE_DARK_HD_CONFIG.colors.surfaceLight}; 
            border: 2px solid ${MOBILE_DARK_HD_CONFIG.colors.border}; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px;
          ">âš½</div>
        `
        }

        <div style="flex: 1; min-width: 0; text-align: right;">
          <div style="
            font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.semibold} ${MOBILE_DARK_HD_CONFIG.fonts.bodySmall};
            color: ${vencedorB ? MOBILE_DARK_HD_CONFIG.colors.success : vencedorA ? MOBILE_DARK_HD_CONFIG.colors.danger : MOBILE_DARK_HD_CONFIG.colors.text};
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          ">
            ${timeB?.nome_time || "Time B"}${vencedorB ? " ðŸ‘‘" : ""}
          </div>

          <div style="
            font: ${MOBILE_DARK_HD_CONFIG.fonts.weights.regular} ${MOBILE_DARK_HD_CONFIG.fonts.caption};
            color: ${MOBILE_DARK_HD_CONFIG.colors.textMuted};
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          ">${timeB?.nome_cartoleiro || timeB?.nome_cartola || "N/D"}</div>
        </div>
      </div>

    </div>
  `;
}