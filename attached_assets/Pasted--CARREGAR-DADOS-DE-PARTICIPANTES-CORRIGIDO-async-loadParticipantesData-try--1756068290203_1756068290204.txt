// üë• CARREGAR DADOS DE PARTICIPANTES (CORRIGIDO)
async loadParticipantesData() {
    try {
        const urlParams = new URLSearchParams(window.location.search);
        const ligaId = urlParams.get('id');

        if (!ligaId) {
            const emptyState = document.querySelector('#participantes-grid') || document.getElementById('dynamic-content-area');
            emptyState.innerHTML = '<div class="empty-state">ID da liga n√£o encontrado</div>';
            return;
        }

        // Mostrar loading no grid espec√≠fico
        const participantesGrid = document.getElementById('participantes-grid');
        if (participantesGrid) {
            participantesGrid.innerHTML = `
                <div class="loading-state-full">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 15px; padding: 60px;">
                        <div class="spinner"></div>
                        <div style="color: #ff4500; font-weight: 600; font-size: 16px">
                            Carregando dados dos participantes...
                        </div>
                    </div>
                </div>
            `;
        }

        const response = await fetch(`/api/ligas/${ligaId}`);
        if (!response.ok) {
            throw new Error('Erro ao carregar liga');
        }

        const liga = await response.json();
        if (!liga.times || liga.times.length === 0) {
            if (participantesGrid) {
                participantesGrid.innerHTML = `
                    <div class="participantes-empty-state">
                        <div class="empty-icon">üë•</div>
                        <div class="empty-title">Nenhum participante</div>
                        <div class="empty-message">Esta liga ainda n√£o possui participantes cadastrados</div>
                    </div>
                `;
            }
            return;
        }

        // Atualizar estat√≠sticas
        this.updateParticipantesStats(liga.times.length);

        // Carregar dados detalhados dos participantes
        let participantesHtml = '';
        let timesUnicos = new Set();

        for (const timeId of liga.times) {
            try {
                const timeResponse = await fetch(`/api/time/${timeId}`);
                if (timeResponse.ok) {
                    const time = await timeResponse.json();
                    
                    // Adicionar √† contagem de times √∫nicos
                    if (time.nome_time && time.nome_time !== 'Time N/A') {
                        timesUnicos.add(time.nome_time);
                    }

                    participantesHtml += `
                        <div class="participante-card">
                            <div class="participante-info">
                                <img src="${time.url_escudo_png || '/escudos/default.png'}" 
                                     alt="Escudo" class="participante-escudo"
                                     onerror="this.src='/escudos/default.png'">
                                <div class="participante-details">
                                    <div class="participante-nome">${time.nome_cartoleiro || 'Cartoleiro N/A'}</div>
                                    <div class="participante-time">${time.nome_time || 'Time N/A'}</div>
                                </div>
                            </div>
                            <div class="participante-stats">
                                <span>‚öΩ Time: ${time.nome_time || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.warn(`Erro ao carregar time ${timeId}:`, error);
            }
        }

        // Injetar no grid espec√≠fico (n√£o sobrescrever tudo)
        if (participantesGrid) {
            participantesGrid.innerHTML = participantesHtml;
        }

        // Atualizar estat√≠sticas finais
        this.updateParticipantesStats(liga.times.length, liga.times.length, timesUnicos.size);

        // Executar script interno do m√≥dulo participantes
        this.executeParticipantesScript();

        console.log(`‚úÖ ${liga.times.length} participantes carregados com sucesso`);

    } catch (error) {
        console.error('‚ùå Erro ao carregar participantes:', error);
        const participantesGrid = document.getElementById('participantes-grid');
        if (participantesGrid) {
            participantesGrid.innerHTML = `
                <div class="participantes-empty-state">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <div class="empty-title">Erro ao carregar</div>
                    <div class="empty-message">${error.message}</div>
                </div>
            `;
        }
    }
}

// üìä ATUALIZAR ESTAT√çSTICAS DOS PARTICIPANTES
updateParticipantesStats(total = 0, ativos = 0, timesUnicos = 0) {
    const totalElement = document.getElementById('total-participantes');
    const ativosElement = document.getElementById('participantes-ativos');
    const timesElement = document.getElementById('times-diferentes');

    if (totalElement) totalElement.textContent = total;
    if (ativosElement) ativosElement.textContent = ativos;
    if (timesElement) timesElement.textContent = timesUnicos;
}

// üé¨ EXECUTAR SCRIPT INTERNO DO M√ìDULO PARTICIPANTES
executeParticipantesScript() {
    // Simular execu√ß√£o do script interno do participantes.html
    setTimeout(() => {
        const participanteCards = document.querySelectorAll('.participante-card');
        console.log(`üë• M√≥dulo Participantes carregado com ${participanteCards.length} cards`);
        
        // Aplicar anima√ß√µes escalonadas
        participanteCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    }, 100);
}