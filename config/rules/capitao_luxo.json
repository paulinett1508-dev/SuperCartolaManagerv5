{
  "id": "capitao_luxo",
  "nome": "Capitão de Luxo",
  "descricao": "Ranking baseado exclusivamente na pontuação do capitão escalado em cada rodada. Premia quem soube escolher os melhores capitães ao longo da temporada.",
  "tipo": "ranking_estatistico",
  "status": "ativo",
  "versao": "1.1.0",

  "configuracao": {
    "ligas_habilitadas": ["684cb1c8af923da7c7df51de", "684d821cf1a7ae16d1f89572"],
    "modulo_ativo": true,
    "temporada": 2026
  },

  "regras": {
    "calculo": {
      "metodo": "soma_pontuacao_capitao",
      "fonte_dados": "API Cartola (time/id/{timeId}/{rodada})",
      "identificacao_capitao": "campo capitao_id na escalação",
      "pontuacao": "pontuacao_atleta * 2 (já aplicado pela API)",
      "nota": "A API Cartola retorna a pontuação do capitão já dobrada. NÃO multiplicar novamente."
    },

    "coleta": {
      "fonte": "API Cartola",
      "endpoint_por_rodada": "/time/id/{timeId}/{rodada}",
      "campo_capitao": "capitao_id",
      "dados_por_rodada": {
        "capitao_id": "ID do atleta capitão",
        "capitao_nome": "Apelido do atleta (atletas[capitao_id].apelido)",
        "capitao_clube": "Clube do atleta (atletas[capitao_id].clube_id)",
        "pontuacao_base": "Pontuação sem bônus",
        "pontuacao_capitao": "Pontuação com bônus x2 (campo pontos do atleta)"
      },
      "parciais_tempo_real": {
        "endpoint": "/atletas/pontuados",
        "habilitado_quando": "mercado_fechado",
        "nota": "Durante rodada ativa, usa endpoint ranking-live"
      }
    },

    "ordenacao": {
      "criterio_principal": "pontuacao_total_capitaes",
      "direcao": "DESC"
    },

    "desempate": {
      "criterios": [
        "maior_media_capitaes",
        "maior_capitao_single",
        "menor_pior_capitao",
        "posicao_ranking_geral"
      ]
    },

    "participantes_inativos": {
      "incluir": true,
      "limitar_rodadas": true,
      "descricao": "Inativos têm rodadas limitadas até rodada_desistencia - 1"
    },

    "estatisticas": {
      "total_pontos": "soma de todas as pontuações de capitães",
      "media_pontos": "total / rodadas_jogadas",
      "melhor_capitao": {
        "rodada": "número da rodada",
        "atleta": "nome do capitão",
        "pontuacao": "valor da pontuação"
      },
      "pior_capitao": {
        "rodada": "número da rodada",
        "atleta": "nome do capitão",
        "pontuacao": "valor da pontuação"
      },
      "capitaes_distintos": "quantidade de atletas diferentes usados como capitão"
    },

    "cache": {
      "collection": "capitaocaches",
      "model": "CapitaoCaches",
      "persistencia": true,
      "campos_indexados": ["ligaId", "temporada", "timeId"]
    },

    "consolidacao": {
      "endpoint": "POST /api/capitao/:ligaId/consolidar",
      "permissao": "verificarAdmin",
      "descricao": "Consolida ranking final da temporada e calcula posições/premiações"
    }
  },

  "campos_ranking": [
    "posicao",
    "timeId",
    "nome_cartola",
    "nome_time",
    "escudo",
    "pontuacao_total",
    "rodadas_jogadas",
    "media_capitao",
    "melhor_capitao",
    "pior_capitao",
    "capitaes_distintos"
  ],

  "premiacao": {
    "campeao": {
      "posicao": 1,
      "valor": 25.00,
      "titulo": "Capitão de Luxo"
    },
    "vice": {
      "posicao": 2,
      "valor": 15.00
    },
    "terceiro": {
      "posicao": 3,
      "valor": 10.00
    }
  },

  "bonificacao_rodada": {
    "habilitado": false,
    "descricao": "Possibilidade futura de bônus para o melhor capitão de cada rodada",
    "valor": 5.00
  },

  "financeiro": {
    "impacto_banco": true,
    "tipo_transacao": "CAPITAO_LUXO",
    "premiacao_fim_temporada": true,
    "moeda": "BRL",
    "precisao_decimal": 2
  },

  "ui": {
    "icone": "military_tech",
    "cor_tema": "#8b5cf6",
    "cor_tema_rgb": "139, 92, 246",
    "gradiente": "linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%)",
    "descricao_participante": "Ranking de Capitães",
    "badge": {
      "texto": "[C]",
      "cor": "#fbbf24",
      "bg": "rgba(251, 191, 36, 0.15)"
    }
  },

  "navegacao": {
    "module_id": "capitao-luxo",
    "admin_card": "capitao-luxo",
    "participante_card": "capitao",
    "html_admin": "/fronts/capitao-luxo.html",
    "html_participante": "/participante/fronts/capitao.html",
    "js_modulo": "/participante/js/modules/participante-capitao.js",
    "funcao_init": "inicializarCapitaoParticipante",
    "bloqueado_pre_temporada": true
  },

  "api": {
    "endpoints": [
      {
        "metodo": "GET",
        "path": "/api/capitao/:ligaId/ranking",
        "descricao": "Ranking consolidado da temporada",
        "params": { "temporada": "query (opcional, default: ano atual)" },
        "resposta": { "success": true, "ranking": [] }
      },
      {
        "metodo": "GET",
        "path": "/api/capitao/:ligaId/ranking-live",
        "descricao": "Ranking em tempo real durante rodada ativa",
        "resposta": { "success": true, "ranking": [], "live": true }
      },
      {
        "metodo": "POST",
        "path": "/api/capitao/:ligaId/consolidar",
        "descricao": "Consolida ranking final (admin only)",
        "permissao": "verificarAdmin"
      }
    ],
    "routes_file": "routes/capitao-routes.js",
    "controller": "controllers/capitaoController.js",
    "service": "services/capitaoService.js"
  },

  "implementacao": {
    "status": "implementado",
    "arquivos": {
      "backend": [
        "models/CapitaoCaches.js",
        "controllers/capitaoController.js",
        "services/capitaoService.js",
        "routes/capitao-routes.js"
      ],
      "frontend": [
        "public/fronts/capitao-luxo.html",
        "public/participante/fronts/capitao.html",
        "public/participante/js/modules/participante-capitao.js"
      ],
      "config": [
        "config/rules/capitao_luxo.json",
        "config/definitions/capitao_luxo_def.json"
      ]
    },
    "orquestrador": {
      "case": "capitao-luxo",
      "loader": "carregarModuloCapitaoLuxo()",
      "fallback_html": true
    }
  },

  "wizard": {
    "titulo": "Configurar Capitao de Luxo",
    "descricao": "Defina premiacao do ranking de capitaes",
    "perguntas": [
      {
        "id": "valor_campeao",
        "tipo": "number",
        "label": "Premio do 1o lugar (R$)",
        "descricao": "Valor para o Capitao de Luxo",
        "default": 25,
        "min": 0,
        "max": 500,
        "step": 5,
        "required": true,
        "afeta": "financeiro_override.valores_por_posicao.1"
      },
      {
        "id": "valor_vice",
        "tipo": "number",
        "label": "Premio do 2o lugar (R$)",
        "descricao": "Valor para o vice",
        "default": 15,
        "min": 0,
        "max": 300,
        "step": 5,
        "required": true,
        "afeta": "financeiro_override.valores_por_posicao.2"
      },
      {
        "id": "valor_terceiro",
        "tipo": "number",
        "label": "Premio do 3o lugar (R$)",
        "descricao": "Valor para o terceiro colocado",
        "default": 10,
        "min": 0,
        "max": 200,
        "step": 5,
        "required": true,
        "afeta": "financeiro_override.valores_por_posicao.3"
      },
      {
        "id": "bonus_rodada",
        "tipo": "boolean",
        "label": "Premiar melhor capitao de cada rodada?",
        "descricao": "Se sim, o melhor capitao de cada rodada ganha bonus",
        "default": false,
        "required": false,
        "afeta": "bonificacao_rodada.habilitado"
      }
    ]
  },

  "metadados": {
    "criado_em": "2025-12-14",
    "atualizado_em": "2026-01-29",
    "autor": "Sistema",
    "fonte": "controllers/capitaoController.js, services/capitaoService.js, models/CapitaoCaches.js"
  }
}
