#!/bin/bash
# Hook PreToolUse: Bloqueia Edit/Write se planejamento n√£o foi feito
# Mecanismo: verifica flag /tmp/.claude-planning-done
#
# - TaskCreate/TaskUpdate ‚Üí cria o flag (planejamento feito)
# - Edit/Write ‚Üí verifica se flag existe, bloqueia se n√£o

TOOL_NAME="$CLAUDE_TOOL_NAME"
FLAG_FILE="/tmp/.claude-planning-done"

# Se √© TaskCreate ou TaskUpdate, marca que planejamento foi feito
if [[ "$TOOL_NAME" == "TaskCreate" || "$TOOL_NAME" == "TaskUpdate" ]]; then
    touch "$FLAG_FILE"
    exit 0
fi

# Se √© Edit ou Write, verifica se planejamento foi feito
if [[ "$TOOL_NAME" == "Edit" || "$TOOL_NAME" == "Write" ]]; then
    if [[ ! -f "$FLAG_FILE" ]]; then
        echo "‚ùå BLOQUEADO: Crie planejamento com TaskCreate antes de editar/escrever c√≥digo."
        echo "üí° Use TaskCreate para listar as tarefas, valide com o usu√°rio, e depois prossiga."
        exit 2
    fi
fi

exit 0
