# ============================================================================
# POST-CHECKOUT HOOK - Sistema H√≠brido de Skills
# ============================================================================
#
# Sincroniza .agent/ ap√≥s trocar de branch para garantir consist√™ncia
#
# Comportamento:
# - Executado ap√≥s git checkout
# - Sempre sincroniza .agent/ (garante que est√° atualizado)
# - N√ÉO adiciona ao staging (apenas atualiza working tree)
# - N√ÉO bloqueia se falhar (apenas avisa)
#
# Para pular: SKIP_SYNC=1 git checkout branch
# ============================================================================

# Par√¢metros do hook
# $1 = ref anterior
# $2 = ref novo
# $3 = flag (1 = checkout de branch, 0 = checkout de arquivo)

# Verificar se deve pular sincroniza√ß√£o
if [ "$SKIP_SYNC" = "1" ]; then
  echo "‚è≠Ô∏è  [POST-CHECKOUT] Sincroniza√ß√£o pulada (SKIP_SYNC=1)"
  exit 0
fi

# S√≥ executar em checkout de branch (n√£o de arquivos individuais)
if [ "$3" = "0" ]; then
  exit 0
fi

echo ""
echo "üîÑ [POST-CHECKOUT] Sincronizando .agent/ ap√≥s checkout..."

# Executar sincroniza√ß√£o (modo quiet - apenas erros)
if node scripts/sync-skills.js --quiet; then
  echo "‚úÖ [POST-CHECKOUT] .agent/ sincronizado com sucesso"
  echo ""
else
  echo "‚ö†Ô∏è  [POST-CHECKOUT] Sincroniza√ß√£o falhou"
  echo "‚ö†Ô∏è  [POST-CHECKOUT] Execute manualmente: npm run sync-skills"
  echo ""
  # N√£o bloquear checkout, apenas avisar
  exit 0
fi

exit 0
