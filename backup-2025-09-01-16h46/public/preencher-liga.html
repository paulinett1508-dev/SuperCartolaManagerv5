<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Criar Nova Liga</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 500px;
        margin: 60px auto;
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h2 {
        text-align: center;
        margin-bottom: 30px;
      }
      input[type="text"] {
        width: calc(100% - 100px);
        padding: 10px;
        font-size: 16px;
        margin-bottom: 10px;
      }
      button {
        padding: 10px 16px;
        font-size: 14px;
        margin-left: 10px;
        border: none;
        border-radius: 4px;
        background-color: #3498db;
        color: white;
        cursor: pointer;
      }
      .info {
        margin: 10px 0;
        font-size: 14px;
      }
      .btn-group {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }
      .btn-group button {
        width: 48%;
      }
      .dados-time {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
        font-size: 15px;
      }
      .dados-time span {
        display: inline-block;
        color: #2c3e50;
      }
      .dados-time .ok {
        color: green;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>âš½ Criar Nova Liga</h2>

      <input type="text" id="nomeLiga" placeholder="Nome da Liga" />

      <div style="margin-top: 10px">
        <input type="text" id="idTime" placeholder="ID do Time" />
        <button onclick="buscarTime()">Buscar</button>
      </div>

      <div class="dados-time" id="dadosTime" style="display: none">
        âœ… <span id="nomeTime">undefined</span> | ðŸ‘¤
        <span id="nomeCartoleiro">undefined</span>
      </div>

      <div class="btn-group">
        <button onclick="adicionarTime()">+ Adicionar Time</button>
        <button onclick="window.location.href='dashboard.html'">
          â¬… Voltar ao Dashboard
        </button>
      </div>

      <div style="margin-top: 10px">
        <button onclick="criarLiga()">Criar Liga</button>
      </div>
    </div>

    <script>
      let times = [];

      async function buscarTime() {
        const id = document.getElementById("idTime").value.trim();
        const nomeSpan = document.getElementById("nomeTime");
        const cartoleiroSpan = document.getElementById("nomeCartoleiro");
        const dadosTime = document.getElementById("dadosTime");

        if (!id) return;

        try {
          const res = await fetch(`/api/time/${id}`);
          const data = await res.json();

          if (data.nome_time && data.nome_cartoleiro) {
            nomeSpan.textContent = data.nome_time;
            cartoleiroSpan.textContent = data.nome_cartoleiro;
            dadosTime.style.display = "flex";

            dadosTime.dataset.id = id;
            dadosTime.dataset.nome_time = data.nome_time;
            dadosTime.dataset.nome_cartoleiro = data.nome_cartoleiro;
          } else {
            nomeSpan.textContent = "NÃ£o encontrado";
            cartoleiroSpan.textContent = "NÃ£o encontrado";
            dadosTime.style.display = "flex";
          }
        } catch (err) {
          nomeSpan.textContent = "Erro";
          cartoleiroSpan.textContent = "Erro";
          dadosTime.style.display = "flex";
        }
      }

      function adicionarTime() {
        const dadosTime = document.getElementById("dadosTime");

        if (!dadosTime.dataset.id || !dadosTime.dataset.nome_time) {
          alert("Busque um time vÃ¡lido antes de adicionar.");
          return;
        }

        const escudo_url = prompt(
          "Informe a URL do escudo do time (opcional):",
          "",
        );

        times.push({
          id: dadosTime.dataset.id,
          nome_time: dadosTime.dataset.nome_time,
          nome_cartoleiro: dadosTime.dataset.nome_cartoleiro,
          escudo_url: escudo_url || "",
        });

        alert("âœ… Time adicionado!");
        document.getElementById("idTime").value = "";
        dadosTime.style.display = "none";
      }

      async function criarLiga() {
        const nome = document.getElementById("nomeLiga").value.trim();

        if (!nome || times.length === 0) {
          alert("Preencha o nome da liga e adicione ao menos 1 time.");
          return;
        }

        const res = await fetch("/api/ligas", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, times }),
        });

        const ligaCriada = await res.json();
        alert("âœ… Liga criada com sucesso!");
        window.location.href = "dashboard.html";
      }
    </script>
  </body>
</html>
